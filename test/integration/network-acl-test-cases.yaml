config:
  inherit-env: true
  retries: 1

tests:
  001 - list network ACLs with no data:
    command: auth0 network-acl list
    exit-code: 0
    stderr:
      contains:
        - No network ACLs available.
        - Use 'auth0 network-acl create' to add one

  002 - list network ACLs with no data (json):
    command: auth0 network-acl list --json
    exit-code: 0
    stdout:
      exactly: "[]"

  003 - create network ACL:
    command: auth0 network-acl create --description "Integration Test ACL" --active true --priority 1 --rule '{"action":{"block":true},"scope":"tenant","match":{"ip_v4_cidrs":["192.168.1.0/24"],"ip_v6_cidrs":["2001:db8::/32"]}}' --no-input
    exit-code: 0
    stdout:
      contains:
        - "ID"
        - "DESCRIPTION          Integration Test ACL"
        - "ACTIVE               ✓"
        - "PRIORITY             1"
        - "RULE"

  004 - list network ACLs with data:
    command: auth0 network-acl list
    exit-code: 0
    stdout:
      contains:
        - ID
        - DESCRIPTION
        - ACTIVE
        - PRIORITY

  # 005 - create network ACL and output in json:
  #   command: auth0 network-acl create --description "Integration Test ACL 2" --active true --priority 2 --rule '{"action":{"allow":true},"scope":"authentication","match":{"country_codes":["US","CA"]}}' --json --no-input
  #   exit-code: 0
  #   stdout:
  #     json:
  #       description: "Integration Test ACL 2"
  #       active: "true"
  #       priority: "2"
  #       rule.scope: "authentication"
  #       rule.action.allow: "true"
  #       rule.match.geo_country_codes: "[US CA]"

  # 006 - show network ACL details:
  #   command: auth0 network-acl show $(./test/integration/scripts/get-network-acl-id.sh)
  #   exit-code: 0
  #   stdout:
  #     contains:
  #       - "ID"
  #       - "DESCRIPTION          Integration Test ACL"
  #       - "ACTIVE               ✓"
  #       - "PRIORITY             1"
  #       - "RULE"

  # 007 - show network ACL details in json:
  #   command: auth0 network-acl show $(./test/integration/scripts/get-network-acl-id.sh) --json
  #   exit-code: 0
  #   stdout:
  #     json:
  #       description: "Integration Test ACL"
  #       active: "true"
  #       priority: "1"
  #       rule.scope: "tenant"
  #       rule.action.block: "true"

  # 008 - update network ACL:
  #   command: auth0 network-acl update $(./test/integration/scripts/get-network-acl-id.sh) --description "Integration Test ACL Updated" --priority 3 --rule '{"action":{"log":true},"scope":"management","match":{"anonymous_proxy":true,"country_codes":["GB","DE"]}}' --no-input
  #   exit-code: 0
  #   stdout:
  #     contains:
  #       - "DESCRIPTION          Integration Test ACL Updated"
  #       - "PRIORITY             3"
  #       - "RULE"

  # 009 - update network ACL and output in json:
  #   command: auth0 network-acl update $(./test/integration/scripts/get-network-acl-id.sh) --description "Integration Test ACL Updated Again" --active false --priority 4 --rule '{"action":{"redirect":true,"redirect_uri":"https://example.com"},"scope":"tenant","match":{"user_agents":["badbot/*"]}}' --json --no-input
  #   exit-code: 0
  #   stdout:
  #     json:
  #       description: "Integration Test ACL Updated Again"
  #       active: "false"
  #       priority: "4"
  #       rule.scope: "tenant"
  #       rule.action.redirect: "true"
  #       rule.action.redirect_uri: "https://example.com"
  #       rule.match.user_agents: "[badbot/*]"

  # 010 - create network ACL with not_match rule:
  #   command: auth0 network-acl create --description "Integration Test ACL Not Match" --active true --priority 5 --rule '{"action":{"block":true},"scope":"tenant","not_match":{"ip_v4_cidrs":["10.0.0.0/8"]}}' --json --no-input
  #   exit-code: 0
  #   stdout:
  #     json:
  #       description: "Integration Test ACL Not Match"
  #       active: "true"
  #       priority: "5"
  #       rule.scope: "tenant"
  #       rule.action.block: "true"
  #       rule.not_match.ip_v4_cidrs: "[10.0.0.0/8]"

  # 011 - delete network ACL:
  #   command: auth0 network-acl delete $(./test/integration/scripts/get-network-acl-id.sh) --force --no-input
  #   exit-code: 0

  012 - delete all network ACLs:
    command: auth0 network-acl delete --all --force --no-input
    exit-code: 0
